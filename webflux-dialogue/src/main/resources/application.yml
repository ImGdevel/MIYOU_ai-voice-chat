spring:
  application:
    name: webflux-dialogue
  data:
    mongodb:
      uri: ${MONGODB_URI:mongodb://localhost:27018/ragdb}
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:16379}
  ai:
    openai:
      api-key: ${OPENAI_API_KEY:}
      base-url: https://api.openai.com
      chat:
        options:
          model: gpt-4o-mini
          temperature: 0.7
    vectorstore:
      qdrant:
        host: ${QDRANT_HOST:localhost}
        port: ${QDRANT_PORT:6334}
        collection-name: ${QDRANT_COLLECTION:user_memories}

server:
  port: 8081

web:
  cors:
    # 실서비스는 기본적으로 Nginx 동일 오리진 프록시를 사용하므로 기본값은 비움.
    # 프론트/백엔드 분리 배포 시에만 WEB_CORS_ALLOWED_ORIGINS를 지정한다.
    allowed-origins: ${WEB_CORS_ALLOWED_ORIGINS:}

rag:
  dialogue:
    supertone:
      endpoints:
        - id: endpoint-1
          api-key: ${SUPERTONE_API_KEY_1:${SUPERTONE_API_KEY:}}
          base-url: ${SUPERTONE_BASE_URL:https://supertoneapi.com}
          max-concurrent-requests: ${SUPERTONE_MAX_CONCURRENT_1:10}
        - id: endpoint-2
          api-key: ${SUPERTONE_API_KEY_2:${SUPERTONE_API_KEY:}}
          base-url: ${SUPERTONE_BASE_URL:https://supertoneapi.com}
          max-concurrent-requests: ${SUPERTONE_MAX_CONCURRENT_2:10}
        - id: endpoint-3
          api-key: ${SUPERTONE_API_KEY_3:${SUPERTONE_API_KEY:}}
          base-url: ${SUPERTONE_BASE_URL:https://supertoneapi.com}
          max-concurrent-requests: ${SUPERTONE_MAX_CONCURRENT_3:10}
        - id: endpoint-4
          api-key: ${SUPERTONE_API_KEY_4:${SUPERTONE_API_KEY:}}
          base-url: ${SUPERTONE_BASE_URL:https://supertoneapi.com}
          max-concurrent-requests: ${SUPERTONE_MAX_CONCURRENT_4:10}
        - id: endpoint-5
          api-key: ${SUPERTONE_API_KEY_5:${SUPERTONE_API_KEY:}}
          base-url: ${SUPERTONE_BASE_URL:https://supertoneapi.com}
          max-concurrent-requests: ${SUPERTONE_MAX_CONCURRENT_5:10}
      voice-id: 2c5f135cb33f49a2c8882d
      language: ko
      style: neutral
      output-format: ${SUPERTONE_OUTPUT_FORMAT:mp3}
      voice-settings:
        pitch-shift: 0
        pitch-variance: 1.0
        speed: 1.1
      credit-monitor:
        enabled: ${SUPERTONE_CREDIT_MONITOR_ENABLED:false}
        poll-interval-seconds: ${SUPERTONE_CREDIT_POLL_INTERVAL:45}
        low-credit-threshold: ${SUPERTONE_LOW_CREDIT_THRESHOLD:10.0}
      circuit-breaker:
        base-backoff-seconds: 5
        max-backoff-seconds: 300
    personas:
      maid:
        voice-id: ${SUPERTONE_VOICE_ID_MAID:2c5f135cb33f49a2c8882d}
        language: ko
        style: neutral
        voice-settings:
          pitch-shift: 0
          pitch-variance: 1.0
          speed: 1.1
      interviewer:
        voice-id: ${SUPERTONE_VOICE_ID_INTERVIEWER:4653d63d07d5340656b6bc}
        language: ko
        style: neutral
        voice-settings:
          pitch-shift: 0
          pitch-variance: 1.0
          speed: 1.0
    stt:
      model: ${OPENAI_STT_MODEL:whisper-1}
      language: ${OPENAI_STT_LANGUAGE:ko}
      max-file-size-bytes: ${OPENAI_STT_MAX_FILE_SIZE_BYTES:26214400}
    qdrant:
      url: ${QDRANT_URL:http://localhost:6334}
      api-key: ${QDRANT_API_KEY:}
      vector-dimension: 1536
      collection-name: user_memories
    memory:
      embedding-model: text-embedding-3-small
      extraction-model: gpt-4o-mini
      conversation-threshold: 5
      importance-boost: 0.05
      importance-threshold: 0.3

monitoring:
  persistent:
    enabled: ${MONITORING_PERSISTENT_ENABLED:true}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
